/* --- Palette & Variables --- */
:root {
    --bg-dark: #1a1a1a;
    --bg-medium: #2c2c2c;
    --bg-light: #3f3f3f;
    --text-light: #e0e0e0;
    --text-medium: #aaaaaa;
    --text-dark: #111111;
    --border-color: #555555;
    --accent-color: #ffb74d; /* Orange */
    --gold-color: #ffd700;
    --player-color: #4caf50; /* Green */
    --enemy-color-base: #f44336; /* Red */
    --enemy-color-alt1: #ff9800; /* Orange (diff from accent) */
    --enemy-color-alt2: #e91e63; /* Pink */
    --wall-color: #795548; /* Brown */
    --floor-color: #424242; /* Dark Grey */
    --exit-color: #2196F3; /* Blue */
    --potion-color: #00bcd4; /* Cyan */
    --hp-color: #4caf50; /* Green */
    --mp-color: #2196F3; /* Blue */
    --xp-color: #ffc107; /* Amber */
    --modal-backdrop: rgba(0, 0, 0, 0.7);
    /* Rarity Colors */
    --rarity-common: #b0bec5; /* Blue Grey */
    --rarity-uncommon: #66bb6a; /* Light Green */
    --rarity-rare: #42a5f5; /* Light Blue */
    --rarity-epic: #ab47bc; /* Purple */
    --rarity-legendary: #ffa726; /* Orange (diff from accent) */
}

/* --- Styles Généraux --- */
body {
    font-family: Georgia, serif; /* Classic RPG feel */
    background-color: var(--bg-dark);
    color: var(--text-light);
    display: flex;
    justify-content: center;
    align-items: flex-start; /* Align container to top */
    padding-top: 20px;
    margin: 0; /* Remove default body margin */
    line-height: 1.5;
    font-size: 16px;
}
#game-container {
    display: flex;
    flex-direction: column;
    border: 2px solid var(--border-color);
    padding: 15px;
    background-color: var(--bg-medium);
    min-width: 700px; /* Minimum width for layout */
    max-width: 950px; /* Maximum reasonable width */
    width: 90%; /* Responsive width */
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
}
h1, h2, h3 {
    color: var(--accent-color);
    margin-top: 0;
    text-align: center;
}
h3 {
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 5px;
    margin-bottom: 10px;
    color: var(--text-medium); /* Subdued color for subheadings */
    font-size: 1.1em; /* Slightly smaller than h2 */
}

/* --- Layout Principal (Flexbox) --- */
#game-screen {
    display: flex;
    flex-wrap: wrap; /* Allow wrapping on smaller screens if needed */
    width: 100%;
    margin-bottom: 15px;
    min-height: 400px; /* Ensure minimum height */
    gap: 15px; /* Space between main area and stats */
}
#main-view-area {
    flex-grow: 1; /* Take up available space */
    display: flex;
    flex-direction: column;
    min-width: 400px; /* Prevent excessive squeezing */
}
#main-view {
    flex-grow: 1; /* Take up vertical space in its area */
    border: 1px solid var(--border-color);
    padding: 5px; /* Minimal padding for more map space */
    background-color: var(--bg-dark);
    display: flex; /* To center content if smaller than view */
    justify-content: center;
    align-items: center;
    min-height: 350px; /* Minimum height for the view */
    overflow: auto; /* Scrollbars if content overflows */
    margin-bottom: 10px;
}
/* Styles for the different views inside main-view */
#map-display, #combat-display, #inventory-display, #skills-display {
    width: 100%;
    height: 100%;
    color: var(--text-light);
}

/* Specific Styles for Map Display */
#map-display {
    font-family: 'Courier New', Courier, monospace; /* Monospace for grid alignment */
    font-size: 0; /* Prevents whitespace issues */
    line-height: 0; /* Crucial for tight tile layout */
    white-space: pre; /* Maintain line breaks from JS */
    background-color: var(--bg-dark); /* Consistent background */
    text-align: left; /* Align grid content */
    overflow: hidden; /* Clip content if necessary */
    align-self: flex-start; /* Align map to top-left */
    padding: 0; /* Remove padding for direct tile rendering */
    border: none; /* Remove border from map itself */
}

/* Styles for other views (Combat, Inventory, Skills) */
#combat-display, #inventory-display, #skills-display {
    white-space: normal; /* Allow text wrapping */
    font-family: Georgia, serif; /* Reset font */
    font-size: 16px;
    line-height: 1.5;
    padding: 15px; /* Add padding inside these views */
    box-sizing: border-box;
}
.hidden {
    display: none !important; /* Utility class to hide elements */
}

/* --- Panneau Stats Joueur (Sidebar) --- */
#player-stats {
    flex-shrink: 0; /* Prevent shrinking */
    width: 250px; /* Fixed width sidebar */
    border: 1px solid var(--border-color);
    padding: 15px;
    background-color: var(--bg-dark);
    box-sizing: border-box;
}
#player-stats p {
    margin: 8px 0;
    font-size: 14px;
    display: flex;
    align-items: center; /* Vertically align icon and text */
}
#player-stats p > span:first-child { /* The icon span */
    margin-right: 8px;
    font-size: 1.2em; /* Slightly larger icon */
    display: inline-block;
    width: 20px; /* Fixed width for alignment */
    text-align: center;
}
/* Tooltip styles (using title attribute) */
#player-stats p span[title] {
    cursor: help; /* Indicate help available on hover */
}
.stat-bar-container {
    background-color: var(--floor-color); /* Dark background for bar */
    border: 1px solid var(--border-color);
    height: 14px; /* Slightly taller bar */
    border-radius: 3px;
    margin: 4px 0 10px 0; /* Add bottom margin */
    overflow: hidden; /* Clip the inner bar */
    width: calc(100% - 2px); /* Adjust for border */
}
.stat-bar {
    height: 100%;
    border-radius: 2px;
    transition: width 0.3s ease-in-out;
    text-align: center;
    font-size: 10px; /* Slightly larger text */
    line-height: 14px; /* Match container height */
    color: rgba(0,0,0,0.8); /* Darker text for contrast */
    font-weight: bold;
    white-space: nowrap; /* Prevent text wrapping */
    overflow: hidden; /* Hide text if bar too small */
}
.hp-bar { background-color: var(--hp-color); }
.mp-bar { background-color: var(--mp-color); }
.xp-bar { background-color: var(--xp-color); }

/* Damage Flash Effect */
.flash-damage {
    animation: flashRed 0.4s ease-out;
}
@keyframes flashRed {
    0%, 100% { box-shadow: none; }
    50% { box-shadow: 0 0 10px 3px rgba(255, 0, 0, 0.8); } /* Brighter flash */
}

/* --- Journal des Messages --- */
#message-log {
    height: 120px; /* Fixed height */
    border: 1px solid var(--border-color);
    padding: 10px;
    overflow-y: scroll; /* Enable vertical scrolling */
    background-color: var(--bg-dark);
    font-size: 13px;
    color: var(--text-medium);
    box-sizing: border-box;
}
#message-log h3 {
    margin-bottom: 5px;
    font-size: 1.0em; /* Consistent heading size */
    color: var(--text-light); /* Brighter heading */
}
#message-log p {
    margin: 0 0 5px 0;
    padding: 0;
    word-break: break-word; /* Prevent long messages overflowing */
}
/* Style for rarity colors within log messages */
#message-log p span[style*="color"] {
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}


/* --- Styles des Tuiles de Jeu (CSS Design) --- */
.tile {
    display: inline-flex; /* Use flex for centering content */
    justify-content: center;
    align-items: center;
    width: 24px; /* Tile size */
    height: 24px;
    vertical-align: top; /* Grid alignment */
    box-sizing: border-box;
    position: relative;
    overflow: hidden;
    margin: 0;
    font-size: 16px; /* Base size for emojis/icons */
    text-align: center;
    line-height: 1; /* Reset line height for flex centering */
    color: var(--text-light); /* Default color for tile content */
    /* transition: transform 0.1s ease-out; Remove default transition */
}
/* Add a base floor background to all tiles, overwritten by specific types */
.tile-floor-bg {
    background-color: var(--floor-color);
    /* Optional subtle texture or gradient for floor */
    /* background-image: linear-gradient(rgba(255,255,255,0.02), rgba(0,0,0,0.02)); */
    box-shadow: inset 0 0 2px rgba(0,0,0,0.1);
}

/* Mur */
.tile-wall {
    background: linear-gradient(135deg, var(--wall-color), #614136);
    border: 1px solid #4d342a;
    box-shadow: inset 1px 1px 3px rgba(0,0,0,0.5);
    font-size: 18px; /* Larger emoji for wall */
    color: #5d4037; /* Darker color for wall emoji */
}

/* Joueur */
.tile-player {
    font-size: 18px; /* Make player slightly larger */
    /* background: radial-gradient(ellipse at center, #81c784 20%, var(--player-color) 80%); */
    /* border-radius: 50%; */
    /* border: 1px solid #388e3c; */
    /* box-shadow: 0 0 6px 1px rgba(129, 199, 132, 0.8); */
    z-index: 10;
    color: var(--player-color); /* Use color for emoji */
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
    transform: scale(1.1); /* Slightly larger */
}

/* Ennemis - Base */
.tile-enemy {
    z-index: 9;
    font-size: 18px;
    transform: scale(1.05); /* Slightly larger */
    /* text-shadow: 1px 1px 2px rgba(0,0,0,0.5); */
}
.tile-enemy-g { color: var(--enemy-color-base); } /* Goblin: Red */
.tile-enemy-s { color: var(--enemy-color-alt1); } /* Skeleton: Orange */
.tile-enemy-o { color: var(--enemy-color-alt2); } /* Orc: Pink/Purple */
.tile-enemy-b { color: var(--rarity-epic); text-shadow: 0 0 5px var(--rarity-epic); transform: scale(1.15); } /* Boss: Epic Purple with glow */


/* Objets */
.tile-item {
    z-index: 5;
    font-size: 16px;
    /* Optional subtle animation for items */
    /* animation: pulseItem 2s infinite ease-in-out; */
}
@keyframes pulseItem {
    0%, 100% { transform: scale(1); opacity: 0.9; }
    50% { transform: scale(1.05); opacity: 1; }
}
.tile-gold { color: var(--gold-color); }
.tile-potion { color: var(--potion-color); }
.tile-chest { color: #bcaaa4; } /* Light brown for chest */

/* Sortie */
.tile-exit {
    z-index: 5;
    color: var(--exit-color);
    font-size: 18px;
    /* background-color: rgba(33, 150, 243, 0.1);
    border: 1px dashed var(--exit-color);
    border-radius: 3px; */
}

/* Éléments Hub */
.tile-hub {
    z-index: 5;
    font-size: 18px;
}
.tile-hub-inn { color: var(--mp-color); }
.tile-hub-dungeon { color: var(--accent-color); }

/* --- Contrôles & Boutons --- */
#controls {
    text-align: center;
    margin-top: 10px;
    padding: 10px 0;
    border-top: 1px solid var(--border-color);
    display: flex;
    flex-wrap: wrap; /* Allow buttons to wrap */
    justify-content: center;
    gap: 10px; /* Space between buttons */
}
#controls button, .action-button, .shop-button, .skill-button, .inventory-button, .modal-button {
    background-color: var(--bg-light);
    color: var(--text-light);
    border: 1px solid var(--border-color);
    padding: 8px 15px;
    margin: 0; /* Use gap instead of margin */
    cursor: pointer;
    font-family: inherit;
    font-size: 14px;
    border-radius: 4px;
    transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease, opacity 0.2s ease;
}
#controls button:hover, .action-button:hover, .shop-button:hover, .skill-button:hover, .inventory-button:hover, .modal-button:hover {
    background-color: var(--accent-color);
    color: var(--text-dark);
    box-shadow: 0 0 5px var(--accent-color);
}
#controls button:active, .action-button:active, .shop-button:active, .skill-button:active, .inventory-button:active, .modal-button:active {
    transform: translateY(1px);
}
#controls button:disabled, .shop-button:disabled, .modal-button:disabled, .inventory-button:disabled, .action-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: var(--bg-light) !important; /* Override hover */
    color: var(--text-medium) !important;
    box-shadow: none !important;
}

#location-info {
    display: block;
    margin-top: 15px; /* More space above location */
    font-size: 13px;
    color: var(--text-medium);
    text-align: center;
}

/* --- Écran de Combat --- */
#combat-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    gap: 20px; /* Space between elements */
}
.combat-participants {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap; /* Allow wrapping if needed */
    width: 100%;
    gap: 15px;
}
.combatant-info {
    border: 1px dashed var(--border-color);
    padding: 15px;
    min-width: 200px; /* Ensure minimum width */
    text-align: center;
    background-color: rgba(0,0,0,0.2);
    border-radius: 5px;
    flex: 1; /* Allow growing/shrinking */
}
.combat-actions {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
}
.combat-actions.disabled button { /* Style disabled state for the container */
    opacity: 0.5;
    cursor: not-allowed;
}
.combat-actions.disabled button:hover {
    background-color: var(--bg-light); /* Prevent hover effect when disabled */
    color: var(--text-medium);
    box-shadow: none;
}

/* Combat Sub-Actions (Skill/Item Selection) */
.combat-sub-actions {
    margin-top: 15px;
    padding: 15px;
    border: 1px dotted var(--border-color);
    background-color: rgba(0,0,0,0.1);
    border-radius: 4px;
    width: 90%;
    max-width: 500px;
    box-sizing: border-box;
}
.combat-sub-actions h4 {
    margin-top: 0;
    margin-bottom: 10px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 5px;
}
.action-buttons-container { /* Container for skill/item buttons */
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: flex-start; /* Align buttons to the left */
}
.combat-sub-actions .modal-button { /* Buttons inside sub-action panels */
    flex-grow: 1; /* Allow buttons to grow */
    min-width: 120px; /* Minimum button width */
}
.combat-sub-actions .cancel-button {
    background-color: #616161; /* Grey cancel button */
    flex-grow: 0; /* Don't allow cancel to grow too much */
    min-width: 80px;
}
.combat-sub-actions .cancel-button:hover {
    background-color: #757575;
}

/* --- Listes (Inventaire, Compétences, Boutique) --- */
.inventory-section { /* Grouping items in inventory */
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}
.inventory-section:last-of-type {
    border-bottom: none;
}

.list-item {
    margin-bottom: 10px;
    padding: 8px 5px; /* Add padding */
    border-bottom: 1px dotted var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    transition: background-color 0.15s ease;
}
.list-item:last-child { border-bottom: none; }
.list-item:hover { background-color: rgba(255, 255, 255, 0.05); }
.list-item > span { /* Direct span children (name, stats) */
    flex-shrink: 1;
    overflow: hidden; /* Prevent text overflow */
    text-overflow: ellipsis; /* Add ellipsis for long text */
}
.list-item strong { color: var(--accent-color); }
.list-item em { color: var(--text-medium); font-style: normal; font-size: 0.9em; }
.list-item .inventory-button {
    margin-left: auto; /* Push buttons to the right */
    flex-shrink: 0;
    padding: 4px 8px;
    font-size: 12px;
}
.list-item .use-button { background-color: var(--hp-color); border-color: #388e3c;}
.list-item .use-button:hover { background-color: #5cb860;}
.list-item .equip-button { background-color: var(--mp-color); border-color: #1976d2;}
.list-item .equip-button:hover { background-color: #42a5f5;}

/* Accessory Specific Styles in Lists */
.accessory-item {
    align-items: flex-start; /* Align items to top */
}
.accessory-name {
    font-weight: bold;
    flex-grow: 1; /* Allow name to take space */
}
.accessory-name span[style*="color"] { /* Ensure colored name is visible */
    display: inline-block; /* Needed for potential line breaks */
}
.accessory-stats {
    color: var(--text-medium);
    font-size: 0.85em;
    text-align: right;
    flex-basis: 120px; /* Slightly more space for stats */
    flex-shrink: 0;
}


/* --- Boutique Modale --- */
#modal-backdrop {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: var(--modal-backdrop); z-index: 998;
    /* display controlled by .hidden class */
}
.modal { /* General modal style */
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 90%; max-width: 650px; max-height: 85vh;
    background-color: var(--bg-medium); border: 2px solid var(--border-color);
    border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.6);
    z-index: 999;
    display: flex; /* Use flex for layout */
    flex-direction: column;
    /* display controlled by .hidden class */
}
#shop-content { padding: 0 20px 20px 20px; overflow-y: auto; flex-grow: 1; } /* Remove top padding */
#shop-modal h2 {
    margin: 0; padding: 15px 20px; background-color: var(--bg-dark);
    border-bottom: 1px solid var(--border-color); border-radius: 8px 8px 0 0;
    font-size: 1.5em; flex-shrink: 0; /* Prevent header shrinking */
}
.shop-category h3 {
    margin-top: 20px; margin-bottom: 10px; color: var(--accent-color);
    border-bottom: 1px solid var(--border-color); padding-bottom: 5px;
}
.shop-sell-info { /* Specific style for sell info text */
    font-size: 0.9em; color: var(--text-medium); margin-bottom: 10px;
}
.shop-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 10px 5px; border-bottom: 1px dotted var(--border-color);
    transition: background-color 0.2s ease; gap: 10px;
}
.shop-item:last-child { border-bottom: none; }
.shop-item:hover { background-color: var(--bg-light); }
.shop-item-info { flex-grow: 1; margin: 0; }
.shop-item-name { font-weight: bold; color: var(--text-light); display: block; } /* Name on its own line */
.shop-item-effect { font-size: 0.9em; color: var(--text-medium); display: block; } /* Effect below name */
.shop-item-cost { color: var(--gold-color); font-weight: bold; margin: 0 10px; }
.shop-item-icon { font-size: 1.3em; width: 30px; text-align: center; flex-shrink: 0; }
.shop-button { flex-shrink: 0; } /* Prevent buttons shrinking */
.buy-button { background-color: var(--hp-color); border-color: #388e3c; }
.buy-button:hover { background-color: #5cb860;}
.sell-button { background-color: var(--gold-color); border-color: #b79000; color: var(--text-dark);}
.sell-button:hover { background-color: #ffeb3b; }

#shop-player-gold {
    text-align: right; padding: 10px 20px; color: var(--gold-color);
    font-weight: bold; flex-shrink: 0; background-color: var(--bg-dark);
    border-top: 1px solid var(--border-color);
}
#shop-modal-controls {
    padding: 10px 20px; text-align: right; background-color: var(--bg-dark);
    border-top: 1px solid var(--border-color); border-radius: 0 0 8px 8px;
    flex-shrink: 0;
}

/* Game Over Overlay */
#game-over-screen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; /* Full screen */
    background-color: rgba(50, 0, 0, 0.9); /* Darker red overlay */
    color: #ffdddd;
    padding: 30px 40px;
    text-align: center;
    z-index: 1000;
    display: flex; /* Center content */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    box-sizing: border-box;
    /* display controlled via .hidden */
}
#game-over-screen.hidden { display: none; }
#game-over-screen h2 {
    margin-top: 0;
    margin-bottom: 20px;
    color: #f44336; /* Use enemy red */
    font-size: 2.5em;
    text-shadow: 2px 2px 5px black;
}
#game-over-screen p {
    font-size: 1.2em;
    margin-bottom: 30px;
}
#game-over-screen button {
    background-color: var(--bg-light);
    color: var(--text-light);
    padding: 10px 20px;
    font-size: 1em;
    cursor: pointer;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    margin: 10px;
    min-width: 200px;
}
#game-over-screen button:hover {
    background-color: var(--accent-color);
    color: var(--text-dark);
}
